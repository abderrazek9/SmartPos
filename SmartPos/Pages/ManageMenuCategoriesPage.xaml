<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:vm="clr-namespace:SmartPos.ViewModels"
  xmlns:models="clr-namespace:SmartPos.Models"
    xmlns:resx="clr-namespace:SmartPos.Resources.Strings;assembly=SmartPos"
  xmlns:controls="clr-namespace:SmartPos.Controls"
  x:Class="SmartPos.Pages.ManageMenuCategoriesPage"
  x:Name="ThisPage"
  Shell.NavBarIsVisible="False"
  x:DataType="vm:ManageMenuCategoriesViewModel">

    <Grid ColumnDefinitions=".68*, .32*">

        <!-- قائمة الفئات -->
        <Grid
      Grid.Column="0"
      Padding="10"
      RowDefinitions="Auto, *"
      RowSpacing="10">

            <Grid Grid.Row="0" ColumnDefinitions="Auto,*">
                            <Label
        Grid.Column="0"
        FontAttributes="Bold"
        FontSize="19"
        Text="{x:Static resx:AppResources.ManageMenuCategoriesPage_Title}" />

                <Label Grid.Column="1"
  Text="{x:Static resx:AppResources.ManageMenuCategoriesPage_SwipeLeftDelete}"
  FontSize="10"
  TextColor="Gray"
  HorizontalOptions="Center"
  Margin="5,4,0,10"/>

            </Grid>
            

            


            <CollectionView
        Grid.Row="1"
        ItemsSource="{Binding Categories}"
        SelectionMode="Single"
        SelectedItem="{Binding SelectedCategory}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:MenuCategoryModel">
                        <SwipeView>

                            <!-- هنا نضيف VisualStateManager --><!--
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="White" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Selected">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#4DC6B4" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>-->

                            <!-- زر الحذف عند السحب -->
                            <SwipeView.RightItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItem
                    Text="{x:Static resx:AppResources.ManageMenuCategoriesPage_Button_Delete}"
                    IconImageSource="delete.png"
                    BackgroundColor="Tomato"
                    Command="{Binding Source={x:Reference ThisPage}, Path=BindingContext.DeleteCategoryCommand}"
                    CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <!-- المحتوى الأصلي مع الأعمدة والمسافات كما في الأصل -->
                            <Grid
                Padding="10"
                ColumnDefinitions="Auto, *, Auto, Auto"
                ColumnSpacing="10"
                BackgroundColor="Transparent">
                                <Image
                  Source="{Binding Icon}"
                  WidthRequest="40"
                  HeightRequest="40"
                  VerticalOptions="Center" />
                                <Label
                  Grid.Column="1"
                  Text="{Binding DisplayName}"
                  VerticalOptions="Center"
                  Margin="10,0,0,0" />
                                <!-- عمود 2 و3 يبقيان فارغين للحفاظ على التخطيط -->
                                <BoxView Grid.Column="2" WidthRequest="0" IsVisible="False" />
                                <BoxView Grid.Column="3" WidthRequest="0" IsVisible="False" />
                            </Grid>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>

        <!-- نموذج إضافة/تعديل فئة جديدة -->
        <Grid
      Grid.Column="1"
      BackgroundColor="{StaticResource LightWheat}"
      RowDefinitions="Auto, *"
      Padding="8,10">
            <VerticalStackLayout Grid.Row="0" Spacing="0">
                <Label Text="{x:Static resx:AppResources.SaveMenuCategoriesPage_Section_Title}" FontSize="15" FontAttributes="Bold" />
                <controls:CurrentDateTimeControl/>
            </VerticalStackLayout>
            <Grid Grid.Row="1" Padding="8,1" BackgroundColor="{StaticResource LightWheat}">
                <controls:SaveMenuCategoriesFormControl
          Cat="{Binding SelectedCategory}"
          OnCancel="SaveMenuCategoriesFormControl_OnCancel"
          OnSaveItem="SaveMenuCategoriesFormControl_OnSaveItem"/>
            </Grid>
        </Grid>

    </Grid>
</ContentPage>